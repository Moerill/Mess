!function(t){function e(e){for(var s,n,r=e[0],i=e[1],o=0,c=[];o<r.length;o++)n=r[o],Object.prototype.hasOwnProperty.call(a,n)&&a[n]&&c.push(a[n][0]),a[n]=0;for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);for(l&&l(e);c.length;)c.shift()()}var s={},a={index:0};function n(e){if(s[e])return s[e].exports;var a=s[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.e=function(t){var e=[],s=a[t];if(0!==s)if(s)e.push(s[2]);else{var r=new Promise((function(e,n){s=a[t]=[e,n]}));e.push(s[2]=r);var i,o=document.createElement("script");o.charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.src=function(t){return n.p+"bundles/"+({"welcome-screen":"welcome-screen"}[t]||t)+"."+{"welcome-screen":"89ea"}[t]+".js"}(t);var l=new Error;i=function(e){o.onerror=o.onload=null,clearTimeout(c);var s=a[t];if(0!==s){if(s){var n=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+r+")",l.name="ChunkLoadError",l.type=n,l.request=r,s[1](l)}a[t]=void 0}};var c=setTimeout((function(){i({type:"timeout",target:o})}),12e4);o.onerror=o.onload=i,document.head.appendChild(o)}return Promise.all(e)},n.m=t,n.c=s,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(s,a,function(e){return t[e]}.bind(null,a));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="modules/mess/scripts/",n.oe=function(t){throw console.error(t),t};var r=window.webpackJsonp=window.webpackJsonp||[],i=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var l=i;n(n.s="./src/scripts/index.js")}({"./src/scripts/actor-item-sort-btn.js":
/*!********************************************!*\
  !*** ./src/scripts/actor-item-sort-btn.js ***!
  \********************************************/
/*! exports provided: default */function(t,e,s){"use strict";async function a(t,e,s){if(!s.actor._id)return;e.querySelectorAll(".filter-list").forEach(t=>{const e=t.closest(".tab").dataset.tab,a=document.createElement("a");a.innerHTML='<i class="fas fa-sort"></i>',a.classList.add("mess-sort-btn"),a.title=`Sort ${e} alphabetically.`,a.style.flex=0,a.style.margin="0 5px 0 0",a.addEventListener("click",t=>async function(t,e){const s=await fromUuid("Actor."+e);let a=t.map(t=>t.items||t.spells).flat();a.sort((function(t,e){return t.name<e.name?-1:t.name>e.name?1:0}));let n=[a.shift()],r=[];for(;a.length>0;n.push(a.shift()))r=SortingHelpers.performIntegerSort(a[0],{target:n[n.length-1],siblings:duplicate(n),sortBefore:!1});const i=r.map(t=>{let e=t.update;return e._id=t.target._id,e});s.updateEmbeddedEntity("OwnedItem",i)}(s[e],s.actor._id)),t.prepend(a)})}async function n(){Hooks.on("renderActorSheet",(t,e,s)=>{a(0,e[0],s)})}s.r(e),s.d(e,"default",(function(){return n}))},"./src/scripts/add-scrolling.js":
/*!**************************************!*\
  !*** ./src/scripts/add-scrolling.js ***!
  \**************************************/
/*! exports provided: default */function(t,e,s){"use strict";async function a(){Hooks.on("renderActorSheet",(async function(t,e,s){e[0].querySelectorAll('input[data-dtype="Number"], .item-uses input').forEach(t=>{t.addEventListener("wheel",t=>{t.preventDefault(),t.stopPropagation(),t.deltaY<0&&(t.currentTarget.value=Number(t.currentTarget.value)+1),t.deltaY>0&&(t.currentTarget.value=Math.max(Number(t.currentTarget.value)-1,0)),$(t.currentTarget).change()})})}))}s.r(e),s.d(e,"default",(function(){return a}))},"./src/scripts/change-placeables.js":
/*!******************************************!*\
  !*** ./src/scripts/change-placeables.js ***!
  \******************************************/
/*! exports provided: changePlaceables */function(t,e,s){"use strict";function a(t){const{clones:e,destination:s,origin:a,originalEvent:n}=t.data;canvas._onDragCanvasPan(n);const r=s.x-a.x,i=s.y-a.y;let o=!1;if(t.data.previous){const e=30,a=.8,n=t.data.previous,r=t.data.momentum||0,i=t.data.v||{x:0,y:0},l={x:s.x-n.x,y:s.y-n.y},c={x:l.x-i.x,y:l.y-i.y};t.data.momentum=c.x*c.x+c.y*c.y+r*a,o=!t.shiftKey&&t.data.momentum<e}t.data.previous=s;for(let t of e||[]){let e={x:t._original.data.x+r,y:t._original.data.y+i};o&&(e=canvas.grid.getSnappedPosition(e.x,e.y,this.layer.options.gridPrecision)),t.data.x=e.x,t.data.y=e.y,t.refresh()}}function n(){PlaceableObject.prototype._onDragLeftMove=a}s.r(e),s.d(e,"changePlaceables",(function(){return n}))},"./src/scripts/chat-popup/index.js":
/*!*****************************************!*\
  !*** ./src/scripts/chat-popup/index.js ***!
  \*****************************************/
/*! exports provided: initChatPopUp */function(t,e,s){"use strict";function a(){Hooks.on("renderChatMessage",(t,e,s)=>{document.getElementById("chat").classList.contains("active")||(console.log("rendering chat message"),console.log(t,e,s),console.log(document.getElementById("chat").classList.contains("active")))}),document.getElementById("hud").appendChild(document.createElement("div")).classList.add("mess-chat-popup")}s.r(e),s.d(e,"initChatPopUp",(function(){return a}))},"./src/scripts/draggable-lists/draggable-list.js":
/*!*******************************************************!*\
  !*** ./src/scripts/draggable-lists/draggable-list.js ***!
  \*******************************************************/
/*! exports provided: DraggableList */function(t,e,s){"use strict";s.r(e),s.d(e,"DraggableList",(function(){return a}));class a{constructor(t,e,s={}){this.container=t,this.selector=e,this.options=mergeObject(this.defaultOptions,s),this._init()}get defaultOptions(){return{offset:21,time:.1,onDragStart:null,onDragEnd:null,onDrop:null}}async _init(){this._items=Array.from(this.container.childNodes).filter(t=>t.matches&&t.matches(this.selector)),this.container.addEventListener("dragleave",t=>{const e=this.container.getBoundingClientRect();!t.insideChild&&t.clientY<e.y+e.height-5&&t.clientY>e.y+5&&t.clientX>e.x+5&&t.clientX<e.x-5+e.width?t.insideChild=!0:this._resetOffsets()}),this.container.addEventListener("drop",t=>{const e=t.insideChild;this._over&&!e&&(Object.defineProperty(t,"target",{writable:!1,value:this._over}),t.insideChild=!0)}),this._items.forEach((t,e)=>this._initItem(t,e))}async _initItem(t,e){t.style.position="relative",t.addEventListener("dragenter",t=>this._onDragEnterItem(t,e)),t.addEventListener("dragleave",t=>this._onDragLeaveItem(t,e)),t.addEventListener("dragend",t=>{const e=t.currentTarget;e.style.opacity=null,e.style.height=null,TweenLite.from(e,this.options.time,{opacity:0,height:0}),this._resetOffsets()}),t.addEventListener("dragstart",t=>{this._dragged=t.currentTarget,TweenLite.to(t.currentTarget,this.options.time,{opacity:0,height:0})})}_onDragEnterItem(t,e){t.stopPropagation(),this._over=this._items[e];const s=this.options.time,a=this.options.offset,n=this._items.slice(0,e);TweenLite.to(n,s,{top:0});const r=this._items.slice(e);return TweenLite.to(r,s,{top:a}),!1}_onDragLeaveItem(t,e){}_resetOffsets(t=this.options.time){TweenLite.to(this._items,t,{top:0})}}},"./src/scripts/draggable-lists/index.js":
/*!**********************************************!*\
  !*** ./src/scripts/draggable-lists/index.js ***!
  \**********************************************/
/*! exports provided: initDraggableLists */function(t,e,s){"use strict";s.r(e),s.d(e,"initDraggableLists",(function(){return n}));var a=s(/*! ./draggable-list */"./src/scripts/draggable-lists/draggable-list.js");function n(){const t=SidebarDirectory.prototype.activateListeners;SidebarDirectory.prototype.activateListeners=function(e){e[0].querySelectorAll(".directory-list, .subdirectory").forEach(t=>new a.DraggableList(t,".entity")),t.call(this,e)},Hooks.on("renderActorSheet",(t,e,s)=>{e[0].querySelectorAll(".item-list").forEach(t=>new a.DraggableList(t,".item"))})}},"./src/scripts/index.js":
/*!******************************!*\
  !*** ./src/scripts/index.js ***!
  \******************************/
/*! no exports provided */function(t,e,s){"use strict";s.r(e);var a=s(/*! ./rolls */"./src/scripts/rolls/index.js"),n=s(/*! ./settings.js */"./src/scripts/settings.js"),r=s(/*! ./modify-templates.js */"./src/scripts/modify-templates.js"),i=s(/*! ./change-placeables.js */"./src/scripts/change-placeables.js"),o=s(/*! ./actor-item-sort-btn.js */"./src/scripts/actor-item-sort-btn.js"),l=s(/*! ./prepared-spell-tracker.js */"./src/scripts/prepared-spell-tracker.js"),c=s(/*! ./add-scrolling.js */"./src/scripts/add-scrolling.js"),d=s(/*! ./draggable-lists */"./src/scripts/draggable-lists/index.js");s(/*! ./chat-popup */"./src/scripts/chat-popup/index.js");Hooks.on("ready",(async function(){if(game.settings.get("mess","actor-item-sort")&&Object(o.default)(),game.settings.get("mess","prepared-spell-tracker")&&Object(l.default)(),game.settings.get("mess","add-scrolling")&&Object(c.default)(),CONFIG.debug.mess){(await fromUuid("Actor.xV3LUAg05Pz5MFTS")).sheet.render(!0)}if(!game.user.isGM)return;const t=game.modules.get("mess"),e=t.data.title,a=t.data.version;game.settings.register(e,"version",{name:e+" Version",default:"0.0.0",type:String,scope:"world"});const n=game.settings.get(e,"version");isNewerVersion(a,n)&&(await s.e(/*! import() | welcome-screen */"welcome-screen").then(s.bind(null,/*! ./welcome-screen.js */"./src/scripts/welcome-screen.js"))).default()})),Hooks.on("init",(function(){game.mess={},CONFIG.debug.mess=!1,n.MessSettings.init(),Object(a.rolling)(),Object(r.dndTemplateSettings)(),Object(r.changeTemplates)(),game.settings.get("mess","change-placeables")&&Object(i.changePlaceables)(),game.settings.get("mess","better-draggable-lists")&&Object(d.initDraggableLists)()}))},"./src/scripts/modify-templates.js":
/*!*****************************************!*\
  !*** ./src/scripts/modify-templates.js ***!
  \*****************************************/
/*! exports provided: changeTemplates, dndTemplateSettings */function(t,e,s){"use strict";function a(){let t=MeasuredTemplate.prototype.refresh.toString();if(game.settings.get("mess","modify-templates")&&(t=t.replace(/this\.template\.beginTextureFill\(\{[\s\S]*\}\)\;/,'\n\t\t\t{\n\t\t\t\tlet mat = PIXI.Matrix.IDENTITY;\n\t\t\t\t// rectangle\n\t\t\t\tif (this.shape.width && this.shape.height)\n\t\t\t\t\tmat.scale(this.shape.width / this.texture.width, this.shape.height / this.texture.height);\n\t\t\t\telse if (this.shape.radius) {\n\t\t\t\t\tmat.scale(this.shape.radius * 2 / this.texture.height, this.shape.radius * 2 / this.texture.width)\n\t\t\t\t\t// Circle center is texture start...\n\t\t\t\t\tmat.translate(-this.shape.radius, -this.shape.radius);\n\t\t\t\t} else if (this.data.t === "ray") {\n\t\t\t\t\tconst d = canvas.dimensions,\n\t\t\t\t\t\t\t\theight = this.data.width * d.size / d.distance,\n\t\t\t\t\t\t\t\twidth = this.data.distance * d.size / d.distance;\n\t\t\t\t\tmat.scale(width / this.texture.width, height / this.texture.height);\n\t\t\t\t\tmat.translate(0, -height * 0.5);\n\n\t\t\t\t\tmat.rotate(toRadians(this.data.direction));\n\t\t\t\t} else {// cone\n\t\t\t\t\tconst d = canvas.dimensions;\n\t\t\t\n\t\t\t\t\t// Extract and prepare data\n\t\t\t\t\tlet {direction, distance, angle} = this.data;\n\t\t\t\t\tdistance *= (d.size / d.distance);\n\t\t\t\t\tdirection = toRadians(direction);\n\t\t\t\t\tconst width = this.data.distance * d.size / d.distance;\n\n\t\t\t\t\tconst angles = [(angle/-2), (angle/2)];\n\t\t\t\t\tdistance = distance / Math.cos(toRadians(angle/2));\n\t\t\t\n\t\t\t\t\t// Get the cone shape as a polygon\n\t\t\t\t\tconst rays = angles.map(a => Ray.fromAngle(0, 0, direction + toRadians(a), distance+1));\n\t\t\t\t\tconst height = Math.sqrt((rays[0].B.x - rays[1].B.x) * (rays[0].B.x - rays[1].B.x)\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ (rays[0].B.y - rays[1].B.y) * (rays[0].B.y - rays[1].B.y));\n\t\t\t\t\tmat.scale(width / this.texture.width, height / this.texture.height);\n\t\t\t\t\tmat.translate(0, -height/2)\n\t\t\t\t\tmat.rotate(toRadians(this.data.direction));\n\t\t\t\t}\n\t\t\t\tthis.template.beginTextureFill({\n\t\t\t\t\ttexture: this.texture,\n\t\t\t\t\tmatrix: mat,\n\t\t\t\t\talpha: 0.8\n\t\t\t\t});\n\t\t\t\t// move into draw or so\n\t\t\t\tconst source = getProperty(this.texture, "baseTexture.resource.source")\n\t\t\t\tif ( source && (source.tagName === "VIDEO") ) {\n\t\t\t\t\tsource.loop = true;\n\t\t\t\t\tsource.muted = true;\n\t\t\t\t\tgame.video.play(source);\n\t\t\t\t}\n\t\t}'),Hooks.on("renderMeasuredTemplateConfig",(t,e,s)=>{e[0].querySelector(".file-picker").dataset.type="imagevideo"})),game.settings.get("mess","templateAutoTargeting")&&(t=t.replace(/this\.\_borderThickness/,"this.texture && !this._hover ? 0 : this._borderThickness"),t=t.replace(/return\sthis\;/,"\n\t\t\tconst grid = canvas.grid;\n\t\t\t// only show grid highlights on hover\n\t\t\tif (this.texture) {\n\t\t\t\tconst hl = grid.getHighlightLayer(`Template.${this.id}`);\n\t\t\t\tif (hl)\n\t\t\t\t\thl.renderable = this._hover;\n\t\t\t}\n\t\t\treturn this;")),MeasuredTemplate.prototype.refresh=Function(`"use strict"; return ( function ${t} )`)(),game.settings.get("mess","templateAutoTargeting")){MeasuredTemplate.prototype.getTargets=i,MeasuredTemplate.prototype.isTokenInside=r;const t=MeasuredTemplate.prototype._onDragLeftMove;MeasuredTemplate.prototype._onDragLeftMove=function(e){const s=t.bind(this)(e);for(let t of e.data.clones)this.getTargets(t);return s}}}async function n(){if("dnd5e"!==game.system.id)return;const t=await import("/systems/dnd5e/module/pixi/ability-template.js"),e=t.default||t.AbilityTemplate;if(game.settings.get("mess","modify-templates")){Hooks.on("renderItemSheet",o);const t=e.fromItem;e.fromItem=function(e){const s=t.bind(this)(e);let a=e.getFlag("mess","templateTexture");if(!a&&e.hasDamage){const t=game.settings.get("mess","templateTexture")||{};a=t[e.data.data.damage.parts[0][1]]||{},a=a[s.data.t]}return a&&loadTexture(a).then(t=>{s.texture=t,s.data.texture=a,s.refresh()}),s.item=e,s}}if(game.settings.get("mess","templateAutoTargeting")){const t=e.prototype.activatePreviewListeners.toString().replace(/this\.refresh\(\)\;/,"this.refresh();\n\t\t\t\t\t\tthis.getTargets(this);\n\t\t\t\t\t");e.prototype.getTargets=i,e.prototype.isTokenInside=r,e.prototype.activatePreviewListeners=Function(`"use strict"; return ( function ${t} )`)()}}function r(t){const e=canvas.scene.data.grid,s=this.data.x,a=this.data.y,n=t.width>=1?.5:t.width/2,r=t.height>=1?.5:t.height/2;for(let i=n;i<t.width;i++)for(let n=r;n<t.height;n++){const r={x:t.x+i*e-s,y:t.y+n*e-a};if(this.shape.contains(r.x,r.y))return!0}return!1}function i(t){const e=canvas.scene.getEmbeddedCollection("Token");let s=[];for(const a of e)t.isTokenInside(a)&&s.push(a._id);game.user.updateTokenTargets(s)}async function o(t,e){const s=document.createElement("div");s.classList.add("form-group"),s.appendChild(document.createElement("label")).innerText=game.i18n.localize("MESS.itemSheet.templateTexture");const a=s.appendChild(document.createElement("div"));a.classList.add("form-fields");const n=a.appendChild(document.createElement("input"));n.dataset.dtype="String",n.type="text",n.name="flags.mess.templateTexture",n.value=t.object.getFlag("mess","templateTexture")||"",a.insertAdjacentHTML("beforeend",'\n\t\t<button type="button" class="file-picker" data-type="imagevideo" data-target="flags.mess.templateTexture" title="Browse Files" tabindex="-1">\n\t\t\t<i class="fas fa-file-import fa-fw"></i>\n\t\t</button>\n\t');const r=a.querySelector("button");r.style.flex="0",t._activateFilePicker(r);const i=e[0].querySelector('[name="data.target.units"]');i&&i.closest(".form-group").after(s)}s.r(e),s.d(e,"changeTemplates",(function(){return a})),s.d(e,"dndTemplateSettings",(function(){return n}))},"./src/scripts/prepared-spell-tracker.js":
/*!***********************************************!*\
  !*** ./src/scripts/prepared-spell-tracker.js ***!
  \***********************************************/
/*! exports provided: default */function(t,e,s){"use strict";async function a(){Hooks.on("renderActorSheet",(async function(t,e,s){const a=await fromUuid("Actor."+s.actor._id);if(a.isNPC)return;if(!e[0].querySelector(".spell-dc"))return;let n=document.createElement("div");n.classList.add("spell-detail"),n.classList.add("spell-slots"),n.style.flex="1",n.style.border="none",n.appendChild(document.createElement("span")).innerText=`${game.i18n.localize("MESS.actorSheet.preparedSpellTracker")}: ${s.preparedSpells}`;const r=n.appendChild(document.createElement("span"));r.innerText=" / ",r.classList.add("sep");const i=n.appendChild(document.createElement("input"));if(i.type="text",i.value=a.getFlag("mess","maxPreparedSpells")||0,i.addEventListener("change",(async function(t){t.preventDefault(),t.stopPropagation();const e=Number(t.currentTarget.value);return isNaN(e)?(t.currentTarget.value=a.getFlag("mess","maxPreparedSpells")||0,!1):(a.setFlag("mess","maxPreparedSpells",e),!1)})),"Tidy5eSheet"===t.constructor.name){const t=e[0].querySelector(".spellcasting-ability");t.appendChild(n,t)}else{const t=e[0].querySelector(".spellbook .inventory-list");n.style.flex="0",n.style.alignSelf="flex-start",n.style.margin="0 8px",t.parentNode.insertBefore(n,t)}}))}s.r(e),s.d(e,"default",(function(){return a}))},"./src/scripts/rolls/apply-dmg.js":
/*!****************************************!*\
  !*** ./src/scripts/rolls/apply-dmg.js ***!
  \****************************************/
/*! exports provided: default */function(t,e,s){"use strict";function a(){Hooks.on("getChatLogEntryContext",(function(t,e){setProperty(game,"mess.chatLogEntryContextOptions",e);const s=t=>canvas.tokens.controlled.length&&t.find(".dice-roll .dice-result").length;for(let t=1;t<e.length;t++)e[t].condition=s}))}s.r(e),s.d(e,"default",(function(){return a}))},"./src/scripts/rolls/controls.js":
/*!***************************************!*\
  !*** ./src/scripts/rolls/controls.js ***!
  \***************************************/
/*! exports provided: default */function(t,e,s){"use strict";async function a(t,e,s){e[0].classList.add("mess");const a=document.createElement("div");a.classList.add("mess-roll-control");const n=game.settings.get("mess",game.userId+".adv-selector"),r={advantage:"advantage"===n,normal:"normal"===n,disadvantage:"disadvantage"===n,...game.settings.get("mess",game.userId+".autoroll-selector")};a.insertAdjacentHTML("afterbegin",await renderTemplate("modules/mess/templates/roll-control.html",r)),a.querySelectorAll(".mess-adv-selector a").forEach(t=>{t.addEventListener("click",(async function(t){t.preventDefault(),t.stopPropagation();const e=Array.from(t.currentTarget.parentNode.querySelectorAll("a")),s=e.findIndex(t=>t.classList.contains("mess-selected"));e[s].classList.remove("mess-selected");const a=e[(s+1)%e.length];a.classList.add("mess-selected"),game.settings.set("mess",game.userId+".adv-selector",a.name)})),t.addEventListener("contextmenu",(async function(t){t.preventDefault(),t.stopPropagation();const e=Array.from(t.currentTarget.parentNode.querySelectorAll("a")),s=e.findIndex(t=>t.classList.contains("mess-selected"));e[s].classList.remove("mess-selected");const a=e[(s+e.length-1)%e.length];a.classList.add("mess-selected"),game.settings.set("mess",game.userId+".adv-selector",a.name)}))}),a.querySelectorAll(".mess-autoroll-selector a").forEach(t=>{t.addEventListener("click",(async function(t){t.preventDefault(),t.stopPropagation(),t.currentTarget.classList.toggle("mess-selected");let e=game.settings.get("mess",game.userId+".autoroll-selector");e[t.currentTarget.name]=t.currentTarget.classList.contains("mess-selected"),game.settings.set("mess",game.userId+".autoroll-selector",e)}))});const i=document.getElementById("chat-controls");i.insertBefore(a,i.childNodes[0])}s.r(e),e.default=function(){Hooks.on("renderChatLog",a),game.settings.register("mess",game.userId+".adv-selector",{name:"Mess - Advantage Selector",default:"normal",type:String,scope:"user"}),game.settings.register("mess",game.userId+".autoroll-selector",{name:"Mess - Autoroll Selector",default:{hit:!1,dmg:!1},type:Object,scope:"user"})}},"./src/scripts/rolls/dice.js":
/*!***********************************!*\
  !*** ./src/scripts/rolls/dice.js ***!
  \***********************************/
/*! exports provided: rollD20, getToHitData, rollToHit, getDmgData, rollDmg */function(t,e,s){"use strict";function a(){return document.getElementById("mess-roll-mod").value}function n(){return game.settings.get("mess",game.userId+".adv-selector")}async function r(t){let e=n(),s=1,r=t.halflingLucky?"r=1":"";"advantage"===e?(s=t.elvenAccuracy?3:2,r+="kh",t.title+=` (${game.i18n.localize("DND5E.Advantage")})`):"disadvantage"===e&&(s=2,r+="kl",t.title+=` (${game.i18n.localize("DND5E.Disadvantage")})`);let i=`${s}d20${r}`;t.reliableTalent&&(i=`{${s}d20${r},10}kh`),t.parts.unshift(i);const o=a();o&&t.parts.push(o);let l=new Roll(t.parts.join("+"),t);l.roll();const c=l.parts[0].total;let d={...t,tooltip:await l.getTooltip(),roll:l,crit:c>=20,fumble:c<=1};const m=await renderTemplate("modules/mess/templates/roll-card.html",d);let g={user:game.user._id,type:CONST.CHAT_MESSAGE_TYPES.OTHER,content:m,speaker:{actor:this,alias:this.name}},u=game.settings.get("core","rollMode");["gmroll","blindroll"].includes(u)&&(g.whisper=ChatMessage.getWhisperIDs("GM")),"blindroll"===u&&(g.blind=!0),ChatMessage.create(g)}async function i({actor:t,item:e}){if(!e.hasAttack)return null;const s=t.data.data,n=e.data.data,r=t.data.flags.dnd5e||{};let i=e.getRollData();const o=["@mod"];("weapon"!==e.data.type||n.proficient)&&o.push("@prof"),i.parts=o,"weapon"===e.data.type&&r.weaponCriticalThreshold&&(i.critical=parseInt(r.weaponCriticalThreshold)),["weapon","spell"].includes(e.data.type)&&r.elvenAccuracy&&["dex","int","wis","cha"].includes(e.abilityMod)&&(i.elvenAccuracy=!0),r.halflingLucky&&(i.halflingLucky=!0);const l=s.bonuses[n.actionType]||{};(n.attackBonus||l.attack)&&(i.atk=[n.attackBonus,l.attack].filterJoin(" + "),isNaN(Number(i.atk))||o.push("@atk"));let c=new Roll(i.parts.join("+"),i);i.totalModifier=c._safeEval(c.formula),i.totalModifier=i.totalModifier>=0?"+"+i.totalModifier:i.totalModifier,i.atk&&!c._formula.includes("@atk")&&(i.parts.push("@atk"),c=new Roll(i.parts.join("+"),i),i.totalModifier+="+"+i.atk);const d=a();return d&&(i.parts.push(d),c=new Roll(i.parts.join("+"),i),i.totalModifier+="+"+d),i.formula=c.formula,i.terms=c._formula,i}async function o(t){const e=t.currentTarget;e.disabled=!0;const s=e.closest(".chat-card"),a=s.closest(".message").dataset.messageId;if(a){const t=game.messages.get(a);if(!t.owner&&!t.isAuthor)return void ui.notifications.error("You do not own the permissions to make that roll!")}const r=CONFIG.Item.entityClass._getChatCardActor(s);if(!r.owner)return!1;const o=r.getOwnedItem(s.dataset.itemId);if(!o)return ui.notifications.error(`The requested item ${s.dataset.itemId} no longer exists on Actor ${r.name}`);let l=await i({actor:r,item:o}),c=n(),d=1,m=l.halflingLucky?"r=1":"";"advantage"===c?(d=l.elvenAccuracy?3:2,m+="kh"):"disadvantage"===c&&(d=2,m+="kl"),l.parts.unshift(`${d}d20${m}`);let g=new Roll(l.parts.join("+"),l);g.roll();let u=document.createElement("div");u.title=`${l.parts[0]}+${l.terms} = ${g.formula} = ${g.total}. Click to see rolls.`,u.classList.add("dice-roll"),u.classList.add("mess-dice-result");const p=u.appendChild(document.createElement("span"));p.innerText=g.total,u.insertAdjacentHTML("beforeend",await g.getTooltip()),u.childNodes[1].classList.add("hidden");const f=l.critical||20,h=l.fumble||1,y=g.parts[0].total;if(y>=f&&(p.classList.add("crit"),s.querySelector(".mess-chat-dmg .mess-chat-roll-type").innerHTML+=" - Crit!",s.querySelectorAll(".mess-button-dmg").forEach((t,e)=>{const s=new RegExp(Die.rgx.die,"g"),a=t.dataset.formula.replace(s,(t,e,s,a)=>(game.settings.get("mess","max-critical")?a=" + "+e*s+(a||""):(e*=2,a=a||""),e+"d"+s+a));t.innerHTML='<i class="fas fa-dice-d20"></i> '+a,t.dataset.formula=a})),y<=h&&p.classList.add("fumble"),t.currentTarget.parentNode.replaceChild(u,t.currentTarget),a){game.messages.get(a).update({content:s.parentNode.innerHTML})}}async function l({actor:t,item:e,spellLevel:s=null}){if(!e.hasDamage)return null;const a=t.data.data,n=e.data.data;let r=e.getRollData();if(s&&(r.item.level=s),r.parts=duplicate(n.damage.parts),n.damage.versatile&&r.parts.splice(1,0,[n.damage.versatile,"versatile"]),!e.getFlag("mess","isBonusDamage"))for(let s of t.items){if(s.id===e.id)continue;let t=[];if(s.getFlag("mess","isBonusDamage")&&s.hasDamage){const e=s.data.data;t.push(e.damage.parts[0][0]);var i=s.name;e.damage.parts[0][1].length>0&&(i+=" - "+game.i18n.localize("DND5E.Damage"+CONFIG.DND5E.damageTypes[e.damage.parts[0][1]])),t.push(i)}t.length>0&&r.parts.push(t)}if("spell"===e.data.type)if("cantrip"===n.scaling.mode){let s=[r.parts[0][0]];const i="character"===t.data.type?a.details.level:a.details.spellLevel;e._scaleCantripDamage(s,i,n.scaling.formula),r.parts[0][0]=s[0]}else if(s&&"level"===n.scaling.mode&&n.scaling.formula){let t=[];e._scaleSpellDamage(t,n.level,s,n.scaling.formula),t.length>0&&(t.push("upcast dice"),r.parts.push(t))}const o=a.bonuses[n.actionType]||{};o.damage&&0!==parseInt(o.damage)&&(r.parts[0][0]+="+@dmg",r.dmg=o.damage);for(let t of r.parts){let e=new Roll(t[0],r);CONFIG.DND5E.damageTypes[t[1]]?t[1]=game.i18n.localize("DND5E.Damage"+CONFIG.DND5E.damageTypes[t[1]]):"versatile"===t[1]&&(t[1]=game.i18n.localize("DND5E.Versatile"));let s=e._evalParentheticalTerms(e.formula).map(t=>t instanceof Roll?(t.roll(),t.total):t);t.push(s.join(""))}return r}async function c(t){const e=t.currentTarget;e.disabled=!0;const s=e.closest(".chat-card"),a=s.closest(".message").dataset.messageId;if(a){const t=game.messages.get(a);if(!t.owner&&!t.isAuthor)return void ui.notifications.error("You do not own the permissions to make that roll!")}const n=e.dataset.formula;let r=new Roll(n);r.roll();let i=document.createElement("div");if(i.title=`${e.dataset.terms} = ${r.formula} = ${r.total}. Click to see rolls.`,i.classList.add("dice-roll"),i.classList.add("mess-dice-result"),i.appendChild(document.createElement("span")).innerText=r.total,i.insertAdjacentHTML("beforeend",await r.getTooltip()),i.childNodes[1].classList.add("hidden"),t.currentTarget.parentNode.replaceChild(i,t.currentTarget),a){game.messages.get(a).update({content:s.parentNode.innerHTML})}}s.r(e),s.d(e,"rollD20",(function(){return r})),s.d(e,"getToHitData",(function(){return i})),s.d(e,"rollToHit",(function(){return o})),s.d(e,"getDmgData",(function(){return l})),s.d(e,"rollDmg",(function(){return c}))},"./src/scripts/rolls/index.js":
/*!************************************!*\
  !*** ./src/scripts/rolls/index.js ***!
  \************************************/
/*! exports provided: rolling */function(t,e,s){"use strict";s.r(e),s.d(e,"rolling",(function(){return i}));var a=s(/*! ./controls.js */"./src/scripts/rolls/controls.js"),n=s(/*! ./apply-dmg.js */"./src/scripts/rolls/apply-dmg.js"),r=s(/*! ./modify-rolling.js */"./src/scripts/rolls/modify-rolling.js");function i(){game.settings.get("mess","modify-rolling")&&(Object(a.default)(),Object(n.default)(),Object(r.default)())}},"./src/scripts/rolls/modify-rolling.js":
/*!*********************************************!*\
  !*** ./src/scripts/rolls/modify-rolling.js ***!
  \*********************************************/
/*! exports provided: default */function(t,e,s){"use strict";s.r(e);var a=s(/*! ./dice.js */"./src/scripts/rolls/dice.js");function n(t){const e=ChatMessage.getSpeaker();let s;e.token&&(s=game.actors.tokens[e.token]),s||(s=game.actors.get(e.actor));const a=s?s.items.filter(e=>e.name===t):[];if(a.length>1)ui.notifications.warn(`Your controlled Actor ${s.name} has more than one Item with name ${t}. The first matched item will be chosen.`);else if(0===a.length)return ui.notifications.warn("Your controlled Actor does not have an item named "+t);const n=a[0],r=!n.getFlag("mess","isBonusDamage");return n.setFlag("mess","isBonusDamage",r),r}async function r(t){const e=document.createElement("div");e.insertAdjacentHTML("afterbegin",t.content);let s=e.querySelector('button[data-action="attack"]');s||(s=e.querySelector('button[data-action="damage"]')),s&&o({currentTarget:s})}function i(t,e){let s=Array.from(t.matchAll(/@RollTable\[([^\]])+\](?:\{([^\}]+)\})?/g));if(s){const e=game.tables;for(let a of s){let s;const n=a[0].match(/\[[a-zA-Z0-9]{16}\]/);if(n)s=e.get(n[0].slice(1,-1));else{const t=a[0].match(/\[([^\]])+\]/)[0].slice(1,-1);s=e.entities.find(e=>e.data.name===t)}let r=s.roll();t=t.replace(a[0],r.results.map(t=>t.text).join(","))}}return t.replace(/\[target\.name\]/g,e.data.name)}async function o(t){"click"===t.type&&(t.preventDefault(),t.stopPropagation());const e=t.currentTarget;e.disabled=!0;const s=e.closest(".chat-card"),n=CONFIG.Item.entityClass._getChatCardActor(s);if(!n||!n.owner)return;const r=n.getOwnedItem(s.dataset.itemId);if(!r)return ui.notifications.error(`The requested item ${s.dataset.itemId} no longer exists on Actor ${n.name}`);let o=game.user.targets;const c=Object.keys(CONFIG.DND5E.areaTargetTypes).includes(getProperty(r,"data.data.target.type"));o.size&&!c||(o=[{data:{name:"someone",img:""}}]);const d=parseInt(s.dataset.spellLevel)||null,m={actor:n,item:r,toHit:await Object(a.getToHitData)({actor:n,item:r}),dmgs:await Object(a.getDmgData)({actor:n,item:r,spellLevel:d}),sceneId:canvas.scene.id,user:game.user.id},g=game.settings.get("mess",game.userId+".autoroll-selector");let u=game.settings.get("core","rollMode");for(const t of o){const e=await r._handleResourceConsumption({isCard:!1,isAttack:!0}),s={...m,target:t.data,flavor:i(r.data.data.chatFlavor,t),allowed:e};let a=await renderTemplate("modules/mess/templates/attack-card.html",s);(g.hit||g.dmg)&&(a=await l(g,a));let n={user:game.user._id,type:CONST.CHAT_MESSAGE_TYPES.OTHER,content:a,speaker:{actor:r.actor._id,token:r.actor.token,alias:r.actor.name}};["gmroll","blindroll"].includes(u)&&(n.whisper=ChatMessage.getWhisperIDs("GM")),"blindroll"===u&&(n.blind=!0),ChatMessage.create(n)}e.disabled=!1}async function l(t,e){let s=document.createElement("div");if(s.classList.add("message"),s.insertAdjacentHTML("afterbegin",e),t.hit){let t=s.querySelector(".mess-button-to-hit");t&&await Object(a.rollToHit)({currentTarget:t})}if(t.dmg){const t=Array.from(s.querySelectorAll(".mess-button-dmg"));for(const e of t)await Object(a.rollDmg)({currentTarget:e})}return s.innerHTML}async function c(t,e,s){const n=e[0].querySelectorAll(".ability-mod, .ability-name");$(n).off(),n.forEach(e=>e.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault();const s=e.currentTarget.closest(".ability").dataset.ability,n=CONFIG.DND5E.abilities[s],r=["@mod"],i={mod:t.object.data.data.abilities[s].mod},o=t.object.data.flags.dnd5e||{},l=getProperty(t.object,"data.data");o.remarkableAthlete&&DND5E.characterFlags.remarkableAthlete.abilities.includes(s)?(r.push("@remarkable-athlete"),i["remarkable-athlete"]=Math.ceil(.5*l.attributes.prof)):o.jackOfAllTrades&&(r.push("@jack-of-all-trades"),i["jack-of-all-trades"]=Math.floor(.5*l.attributes.prof));let c=getProperty(t.object.data.data.bonuses,"abilities.check");return c&&(r.push("@checkBonus"),i.checkBonus=c),i.parts=r,i.title=game.i18n.format("DND5E.AbilityPromptTitle",{ability:n}),a.rollD20.bind(t.object)(i),!0}))),e[0].querySelectorAll(".ability-save").forEach(e=>e.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault();const s=e.currentTarget.closest(".ability").dataset.ability,n=CONFIG.DND5E.abilities[s],r=t.object.data.data.abilities[s],i=["@mod"],o={mod:r.mod};r.prof>0&&(i.push("@prof"),o.prof=r.prof);const l=getProperty(t.object.data.data.bonuses,"abilities.save");l&&(i.push("@saveBonus"),o.saveBonus=l),o.title=game.i18n.format("DND5E.SavePromptTitle",{ability:n}),o.parts=i,a.rollD20.bind(t.object)(o)})));const r=e[0].querySelectorAll(".skill-name");$(r).off(),r.forEach(e=>e.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault();const s=e.currentTarget.closest(".skill").dataset.skill,n=t.object.data.data.skills[s],r=["@mod"],i={mod:n.mod+n.prof};return n.bonus&&(i.skillBonus=n.bonus,r.push("@skillBonus")),i.reliableTalent=n.value>=1&&t.object.getFlag("dnd5e","reliableTalent"),i.parts=r,i.title=game.i18n.format("DND5E.SkillPromptTitle",{skill:CONFIG.DND5E.skills[s]}),a.rollD20.bind(t.object)(i),!1})))}function d(t){t||(t=$(document.getElementById("chat-log"))),t.on("click",".card-buttons button",m.bind(this)),t.on("click",".item-name",this._onChatCardToggleContent.bind(this)),t.on("mouseenter",".mess-chat-target",g),t.on("mouseleave",".mess-chat-target",u),t.on("dblclick",".mess-chat-target",p),t.on("click",".mess-button-to-hit",a.rollToHit),t.on("click",".mess-button-dmg",a.rollDmg)}async function m(t){return t.preventDefault(),t.stopPropagation(),"attack"===t.currentTarget.dataset.action||"damage"===t.currentTarget.dataset.action?o(t):t.currentTarget.dataset.placeTemplate?renderTemplate(t):this._onChatCardAction(t)}async function g(t){t.preventDefault(),t.stopPropagation();const e=await f(t);if(!e)return!1;e._onHoverIn()}async function u(t){t.preventDefault(),t.stopPropagation();const e=await f(t);if(!e||!e.visible)return!1;e._onHoverOut()}async function p(t){t.preventDefault(),t.stopPropagation();const e=await f(t);if(!e||!e.visible)return!1;const s=e.center;canvas.animatePan({x:s.x,y:s.y})}async function f(t){const e=t.currentTarget.closest(".mess-attack-card");if(e.dataset.sceneId!==canvas.scene.id)return!1;const s=e.dataset.targetId;if(!s)return!1;const a=canvas.tokens.placeables.find(t=>t.id===s);return a||!1}e.default=function(){CONFIG.Item.entityClass.chatListeners=d.bind(CONFIG.Item.entityClass),Hooks.on("preCreateChatMessage",r),Hooks.on("renderActorSheet",c),Hooks.on("renderItemSheet",(t,e,s)=>{let a=document.createElement("div");a.classList.add("form-group"),a.appendChild(document.createElement("label")).innerText=game.i18n.localize("MESS.itemSheet.bonusDmg");let n=a.appendChild(document.createElement("div"));n.classList.add("form-fields");let r=n.appendChild(document.createElement("input"));r.type="checkbox",r.name="flags.mess.isBonusDamage",r.checked=t.object.getFlag("mess","isBonusDamage");const i=e[0].querySelector('[name="data.formula"]');i&&i.closest(".form-group").after(a)}),game.mess.toggleItemBonusDamage=n}},"./src/scripts/settings.js":
/*!*********************************!*\
  !*** ./src/scripts/settings.js ***!
  \*********************************/
/*! exports provided: MessSettings */function(t,e,s){"use strict";s.r(e),s.d(e,"MessSettings",(function(){return a}));class a extends FormApplication{static init(){const t="dnd5e"===game.system.id;game.settings.register("mess","actor-item-sort",{name:"Activate item sort button.",hint:"Adds a button to actor sheets for sorting all items of that category alphabetically.",scope:"world",config:!1,default:t,type:Boolean}),game.settings.register("mess","better-draggable",{name:"Activate better drag'n'drop workflow.",scope:"world",config:!1,default:t,type:Boolean}),game.settings.register("mess","better-draggable-lists",{name:"Activate better drag'n'drop workflow for lists.",scope:"world",config:!1,default:!0,type:Boolean}),game.settings.register("mess","prepared-spell-tracker",{name:"Activate prepared spell tracker",hint:"Adds a tracker to the spellbook tab, providing a way to track the allowed maximum of prepared spells.",scope:"world",config:!1,default:t,type:Boolean}),game.settings.register("mess","add-scrolling",{name:"Activating numerical field scrolling.",hint:"Lets you in-/decrease numerical fields in the Actor sheet using the mouse wheel when focused.",scope:"world",config:!1,default:t,type:Boolean}),game.settings.register("mess","modify-rolling",{name:"Alternative Rolling.",hint:"Changes the way rolling is displayed and executed for DnD5e. Reload for all connected clients is required for this to take effect if changed!",scope:"world",config:!1,default:t,type:Boolean}),game.settings.register("mess","modify-templates",{name:"Activate modified templates.",hint:"Makes templates texture fill scaling instead of tiling and does allow the usage of videos as texture. Reload for all connected clients is required for this to take effect if changed!",scope:"world",config:!1,default:!0,type:Boolean}),game.settings.register("mess","change-placeables",{name:"Activate placeables changes.",hint:"Changes some behaviours of placeables, like preview snapping to grid. Reload for all connected clients is required for this to take effect if changed!",scope:"world",config:!1,default:!0,type:Boolean}),game.settings.registerMenu("mess","templateTexture",{name:game.i18n.localize("MESS.FVTTSettings.description"),label:game.i18n.localize("MESS.FVTTSettings.button"),icon:"fas fa-mug-hot",type:a,restricted:!0}),game.settings.register("mess","templateTexture",{name:"Activate placeables changes.",hint:"Changes some behaviours of placeables, like preview snapping to grid. Reload for all connected clients is required for this to take effect if changed!",scope:"world",default:!0,type:Object}),game.settings.register("mess","max-critical",{name:"Activate maximum critical rolls.",hint:"Changes behaviour of critical damage rolls to maximize the damage of the extra dice for criticals!",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("mess","templateTexture",{name:"Activate placeables changes.",hint:"Changes some behaviours of placeables, like preview snapping to grid. Reload for all connected clients is required for this to take effect if changed!",scope:"world",config:!1,default:!0,type:Object}),game.settings.register("mess","templateAutoTargeting",{scope:"world",default:!0,type:Boolean}),game.settings.register("mess","templateDrawBordersOnlyOnHighlight",{scope:"world",default:!0,type:Boolean}),this.loadTemplates()}static loadTemplates(){loadTemplates(["modules/mess/templates/settings/templates.html","modules/mess/templates/settings/dnd5e.html","modules/mess/templates/settings/misc.html"])}static get defaultOptions(){return{...super.defaultOptions,template:"modules/mess/templates/settings/settings.html",height:"auto",title:"Mess - Moerills enhancing super-suit(e) - Settings Menu",width:600,classes:["mess","settings"],tabs:[{navSelector:".tabs",contentSelector:"form",initial:"name"}],submitOnClose:!0}}constructor(t={},e){super(t,e),this.object=game.settings.get("mess","templateTexture")}_getHeaderButtons(){let t=super._getHeaderButtons();return t[0].label="Save & Close",t}getSettingsData(){const t="dnd5e"===game.system.id;let e={"modify-templates":game.settings.get("mess","modify-templates"),"change-placeables":game.settings.get("mess","change-placeables"),templateTexture:game.settings.get("mess","templateTexture"),templateAutoTargeting:game.settings.get("mess","templateAutoTargeting"),templateDrawBordersOnlyOnHighlight:game.settings.get("mess","templateDrawBordersOnlyOnHighlight"),"better-draggable-lists":game.settings.get("mess","better-draggable-lists")};return t&&(e.templateTexture=game.settings.get("mess","templateTexture"),e["modify-rolling"]=game.settings.get("mess","modify-rolling"),e["max-critical"]=game.settings.get("mess","max-critical"),e["actor-item-sort"]=game.settings.get("mess","actor-item-sort"),e["prepared-spell-tracker"]=game.settings.get("mess","prepared-spell-tracker"),e["add-scrolling"]=game.settings.get("mess","add-scrolling")),e}getData(){const t="dnd5e"===game.system.id;let e=super.getData();return t&&(e.dmgTypes=CONFIG.DND5E.damageTypes,e.templateTypes=CONFIG.MeasuredTemplate.types),e.isDnD=t,e.settings=this.getSettingsData(),e}activateListeners(t){super.activateListeners(t)}_updateObject(t,e){const s=expandObject(e);for(let[t,e]of Object.entries(s))game.settings.set("mess",t,e);new Dialog({content:`<p>${game.i18n.localize("MESS.reloadReminder.text")}</p>`,buttons:{yes:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("MESS.reloadReminder.yes"),callback:()=>location.reload()},no:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("MESS.reloadReminder.no")}}}).render(!0)}}}});
//# sourceMappingURL=index.js.map