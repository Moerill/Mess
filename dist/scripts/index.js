!function(t){function e(e){for(var s,n,r=e[0],i=e[1],o=0,c=[];o<r.length;o++)n=r[o],Object.prototype.hasOwnProperty.call(a,n)&&a[n]&&c.push(a[n][0]),a[n]=0;for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);for(l&&l(e);c.length;)c.shift()()}var s={},a={index:0};function n(e){if(s[e])return s[e].exports;var a=s[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.e=function(t){var e=[],s=a[t];if(0!==s)if(s)e.push(s[2]);else{var r=new Promise((function(e,n){s=a[t]=[e,n]}));e.push(s[2]=r);var i,o=document.createElement("script");o.charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.src=function(t){return n.p+"bundles/"+({"welcome-screen":"welcome-screen"}[t]||t)+"."+{"welcome-screen":"a969"}[t]+".js"}(t);var l=new Error;i=function(e){o.onerror=o.onload=null,clearTimeout(c);var s=a[t];if(0!==s){if(s){var n=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+r+")",l.name="ChunkLoadError",l.type=n,l.request=r,s[1](l)}a[t]=void 0}};var c=setTimeout((function(){i({type:"timeout",target:o})}),12e4);o.onerror=o.onload=i,document.head.appendChild(o)}return Promise.all(e)},n.m=t,n.c=s,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(s,a,function(e){return t[e]}.bind(null,a));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="modules/mess/scripts/",n.oe=function(t){throw console.error(t),t};var r=window.webpackJsonp=window.webpackJsonp||[],i=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var l=i;n(n.s="./src/scripts/index.js")}({"./src/scripts/actor-item-sort-btn.js":
/*!********************************************!*\
  !*** ./src/scripts/actor-item-sort-btn.js ***!
  \********************************************/
/*! exports provided: default */function(t,e,s){"use strict";async function a(t,e,s){if(!s.actor._id)return;e.querySelectorAll(".filter-list").forEach(t=>{const e=t.closest(".tab").dataset.tab,a=document.createElement("a");a.innerHTML='<i class="fas fa-sort"></i>',a.classList.add("mess-sort-btn"),a.title=`Sort ${e} alphabetically.`,a.style.flex=0,a.style.margin="0 5px 0 0",a.addEventListener("click",t=>async function(t,e){const s=await fromUuid("Actor."+e);let a=t.map(t=>t.items||t.spells).flat();a.sort((function(t,e){return t.name<e.name?-1:t.name>e.name?1:0}));let n=[a.shift()],r=[];for(;a.length>0;n.push(a.shift()))r=SortingHelpers.performIntegerSort(a[0],{target:n[n.length-1],siblings:duplicate(n),sortBefore:!1});const i=r.map(t=>{let e=t.update;return e._id=t.target._id,e});s.updateEmbeddedEntity("OwnedItem",i)}(s[e],s.actor._id)),t.prepend(a)})}async function n(){Hooks.on("renderActorSheet",(t,e,s)=>{a(0,e[0],s)})}s.r(e),s.d(e,"default",(function(){return n}))},"./src/scripts/add-scrolling.js":
/*!**************************************!*\
  !*** ./src/scripts/add-scrolling.js ***!
  \**************************************/
/*! exports provided: default */function(t,e,s){"use strict";async function a(){Hooks.on("renderActorSheet",(async function(t,e,s){e[0].querySelectorAll('input[data-dtype="Number"], .item-uses input').forEach(t=>{t.addEventListener("wheel",t=>{t.preventDefault(),t.stopPropagation(),t.deltaY<0&&(t.currentTarget.value=Number(t.currentTarget.value)+1),t.deltaY>0&&(t.currentTarget.value=Math.max(Number(t.currentTarget.value)-1,0)),$(t.currentTarget).change()})})}))}s.r(e),s.d(e,"default",(function(){return a}))},"./src/scripts/change-placeables.js":
/*!******************************************!*\
  !*** ./src/scripts/change-placeables.js ***!
  \******************************************/
/*! exports provided: changePlaceables */function(t,e,s){"use strict";function a(t){const{clones:e,destination:s,origin:a,originalEvent:n}=t.data;canvas._onDragCanvasPan(n);const r=s.x-a.x,i=s.y-a.y;let o=!1;if(t.data.previous){const e=30,a=.8,n=t.data.previous,r=t.data.momentum||0,i=t.data.v||{x:0,y:0},l={x:s.x-n.x,y:s.y-n.y},c={x:l.x-i.x,y:l.y-i.y};t.data.momentum=c.x*c.x+c.y*c.y+r*a,o=!t.shiftKey&&t.data.momentum<e}t.data.previous=s;for(let t of e||[]){let e={x:t._original.data.x+r,y:t._original.data.y+i};o&&(e=canvas.grid.getSnappedPosition(e.x,e.y,this.layer.options.gridPrecision)),t.data.x=e.x,t.data.y=e.y,t.refresh()}}function n(){PlaceableObject.prototype._onDragLeftMove=a}s.r(e),s.d(e,"changePlaceables",(function(){return n}))},"./src/scripts/index.js":
/*!******************************!*\
  !*** ./src/scripts/index.js ***!
  \******************************/
/*! no exports provided */function(t,e,s){"use strict";s.r(e);var a=s(/*! ./settings.js */"./src/scripts/settings.js"),n=s(/*! ./modify-templates.js */"./src/scripts/modify-templates.js"),r=s(/*! ./change-placeables.js */"./src/scripts/change-placeables.js"),i=s(/*! ./actor-item-sort-btn.js */"./src/scripts/actor-item-sort-btn.js"),o=s(/*! ./prepared-spell-tracker.js */"./src/scripts/prepared-spell-tracker.js"),l=s(/*! ./add-scrolling.js */"./src/scripts/add-scrolling.js");Hooks.on("ready",(async function(){if(game.settings.get("mess","actor-item-sort")&&Object(i.default)(),game.settings.get("mess","prepared-spell-tracker")&&Object(o.default)(),game.settings.get("mess","add-scrolling")&&Object(l.default)(),!game.user.isGM)return;const t=game.modules.get("mess"),e=t.data.title,a=t.data.version;game.settings.register(e,"version",{name:e+" Version",default:"0.0.0",type:String,scope:"world"});const n=game.settings.get(e,"version");isNewerVersion(a,n)&&(await s.e(/*! import() | welcome-screen */"welcome-screen").then(s.bind(null,/*! ./welcome-screen.js */"./src/scripts/welcome-screen.js"))).default()})),Hooks.on("init",(function(){game.mess={},a.MessSettings.init(),Object(n.dndTemplateSettings)(),Object(n.changeTemplates)(),game.settings.get("mess","change-placeables")&&Object(r.changePlaceables)()}))},"./src/scripts/modify-templates.js":
/*!*****************************************!*\
  !*** ./src/scripts/modify-templates.js ***!
  \*****************************************/
/*! exports provided: changeTemplates, dndTemplateSettings */function(t,e,s){"use strict";function a(){let t=MeasuredTemplate.prototype.refresh.toString();if(game.settings.get("mess","modify-templates")&&(t=t.replace(/this\.template\.beginTextureFill\(\{[\s\S]*\}\)\;/,'\n\t\t\t{\n\t\t\t\tlet mat = PIXI.Matrix.IDENTITY;\n\t\t\t\t// rectangle\n\t\t\t\tif (this.shape.width && this.shape.height)\n\t\t\t\t\tmat.scale(this.shape.width / this.texture.width, this.shape.height / this.texture.height);\n\t\t\t\telse if (this.shape.radius) {\n\t\t\t\t\tmat.scale(this.shape.radius * 2 / this.texture.height, this.shape.radius * 2 / this.texture.width)\n\t\t\t\t\t// Circle center is texture start...\n\t\t\t\t\tmat.translate(-this.shape.radius, -this.shape.radius);\n\t\t\t\t} else if (this.data.t === "ray") {\n\t\t\t\t\tconst d = canvas.dimensions,\n\t\t\t\t\t\t\t\theight = this.data.width * d.size / d.distance,\n\t\t\t\t\t\t\t\twidth = this.data.distance * d.size / d.distance;\n\t\t\t\t\tmat.scale(width / this.texture.width, height / this.texture.height);\n\t\t\t\t\tmat.translate(0, -height * 0.5);\n\n\t\t\t\t\tmat.rotate(toRadians(this.data.direction));\n\t\t\t\t} else {// cone\n\t\t\t\t\tconst d = canvas.dimensions;\n\t\t\t\n\t\t\t\t\t// Extract and prepare data\n\t\t\t\t\tlet {direction, distance, angle} = this.data;\n\t\t\t\t\tdistance *= (d.size / d.distance);\n\t\t\t\t\tdirection = toRadians(direction);\n\t\t\t\t\tconst width = this.data.distance * d.size / d.distance;\n\n\t\t\t\t\tconst angles = [(angle/-2), (angle/2)];\n\t\t\t\t\tdistance = distance / Math.cos(toRadians(angle/2));\n\t\t\t\n\t\t\t\t\t// Get the cone shape as a polygon\n\t\t\t\t\tconst rays = angles.map(a => Ray.fromAngle(0, 0, direction + toRadians(a), distance+1));\n\t\t\t\t\tconst height = Math.sqrt((rays[0].B.x - rays[1].B.x) * (rays[0].B.x - rays[1].B.x)\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ (rays[0].B.y - rays[1].B.y) * (rays[0].B.y - rays[1].B.y));\n\t\t\t\t\tmat.scale(width / this.texture.width, height / this.texture.height);\n\t\t\t\t\tmat.translate(0, -height/2)\n\t\t\t\t\tmat.rotate(toRadians(this.data.direction));\n\t\t\t\t}\n\t\t\t\tthis.template.beginTextureFill({\n\t\t\t\t\ttexture: this.texture,\n\t\t\t\t\tmatrix: mat,\n\t\t\t\t\talpha: 0.8\n\t\t\t\t});\n\t\t\t\t// move into draw or so\n\t\t\t\tconst source = getProperty(this.texture, "baseTexture.resource.source")\n\t\t\t\tif ( source && (source.tagName === "VIDEO") ) {\n\t\t\t\t\tsource.loop = true;\n\t\t\t\t\tsource.muted = true;\n\t\t\t\t\tgame.video.play(source);\n\t\t\t\t}\n\t\t}'),Hooks.on("renderMeasuredTemplateConfig",(t,e,s)=>{e[0].querySelector(".file-picker").dataset.type="imagevideo"})),game.settings.get("mess","templateDrawBordersOnlyOnHighlight")&&(t=t.replace(/this\.\_borderThickness/,"this.texture && !this._hover ? 0 : this._borderThickness"),t=t.replace(/return\sthis\;/,"\n\t\t\tconst grid = canvas.grid;\n\t\t\t// only show grid highlights on hover\n\t\t\tif (this.texture) {\n\t\t\t\tconst hl = grid.getHighlightLayer(`Template.${this.id}`);\n\t\t\t\tif (hl)\n\t\t\t\t\thl.renderable = this._hover;\n\t\t\t}\n\t\t\treturn this;")),MeasuredTemplate.prototype.refresh=Function(`"use strict"; return ( function ${t} )`)(),game.settings.get("mess","templateAutoTargeting")){MeasuredTemplate.prototype.getTargets=i,MeasuredTemplate.prototype.isTokenInside=r;const t=MeasuredTemplate.prototype._onDragLeftMove;MeasuredTemplate.prototype._onDragLeftMove=function(e){const s=t.bind(this)(e);for(let t of e.data.clones)this.getTargets(t);return s}}}async function n(){if("dnd5e"!==game.system.id)return;const t=await import("/systems/dnd5e/module/pixi/ability-template.js"),e=t.default||t.AbilityTemplate;if(game.settings.get("mess","modify-templates")){Hooks.on("renderItemSheet",o);const t=e.fromItem;e.fromItem=function(e){const s=t.bind(this)(e);let a=e.getFlag("mess","templateTexture");if(!a&&e.hasDamage){const t=game.settings.get("mess","templateTexture")||{};a=t[e.data.data.damage.parts[0][1]]||{},a=a[s.data.t]}return a&&loadTexture(a).then(t=>{s.texture=t,s.data.texture=a,s.refresh()}),s.item=e,s}}if(game.settings.get("mess","templateAutoTargeting")){const t=e.prototype.activatePreviewListeners.toString().replace(/this\.refresh\(\)\;/,"this.refresh();\n\t\t\t\t\t\tthis.getTargets(this);\n\t\t\t\t\t");e.prototype.getTargets=i,e.prototype.isTokenInside=r,e.prototype.activatePreviewListeners=Function(`"use strict"; return ( function ${t} )`)()}}function r(t){const e=canvas.scene.data.grid,s=this.data.x,a=this.data.y,n=t.width>=1?.5:t.width/2,r=t.height>=1?.5:t.height/2;for(let i=n;i<t.width;i++)for(let n=r;n<t.height;n++){const r={x:t.x+i*e-s,y:t.y+n*e-a};if(this.shape.contains(r.x,r.y))return!0}return!1}function i(t){const e=canvas.scene.getEmbeddedCollection("Token");let s=[];for(const a of e)t.isTokenInside(a)&&s.push(a._id);game.user.updateTokenTargets(s)}async function o(t,e){const s=document.createElement("div");s.classList.add("form-group"),s.appendChild(document.createElement("label")).innerText=game.i18n.localize("MESS.itemSheet.templateTexture");const a=s.appendChild(document.createElement("div"));a.classList.add("form-fields");const n=a.appendChild(document.createElement("input"));n.dataset.dtype="String",n.type="text",n.name="flags.mess.templateTexture",n.value=t.object.getFlag("mess","templateTexture")||"",a.insertAdjacentHTML("beforeend",'\n\t\t<button type="button" class="file-picker" data-type="imagevideo" data-target="flags.mess.templateTexture" title="Browse Files" tabindex="-1">\n\t\t\t<i class="fas fa-file-import fa-fw"></i>\n\t\t</button>\n\t');const r=a.querySelector("button");r.style.flex="0",t._activateFilePicker(r);const i=e[0].querySelector('[name="data.target.units"]');i&&i.closest(".form-group").after(s)}s.r(e),s.d(e,"changeTemplates",(function(){return a})),s.d(e,"dndTemplateSettings",(function(){return n}))},"./src/scripts/prepared-spell-tracker.js":
/*!***********************************************!*\
  !*** ./src/scripts/prepared-spell-tracker.js ***!
  \***********************************************/
/*! exports provided: default */function(t,e,s){"use strict";async function a(){Hooks.on("renderActorSheet",(async function(t,e,s){const a=await fromUuid("Actor."+s.actor._id);if(a.isNPC)return;if(!e[0].querySelector(".spell-dc"))return;let n=document.createElement("div");n.classList.add("spell-detail"),n.classList.add("spell-slots"),n.style.flex="1",n.style.border="none";n.appendChild(document.createElement("span")).innerText=`${game.i18n.localize("MESS.actorSheet.preparedSpellTracker")}: ${s.preparedSpells}`;const r=n.appendChild(document.createElement("span"));r.innerText=" / ",r.classList.add("sep");const i=n.appendChild(document.createElement("input"));if(i.type="text",i.value=a.getFlag("mess","maxPreparedSpells")||0,i.addEventListener("change",(async function(t){t.preventDefault(),t.stopPropagation();const e=Number(t.currentTarget.value);return isNaN(e)?(t.currentTarget.value=a.getFlag("mess","maxPreparedSpells")||0,!1):(a.setFlag("mess","maxPreparedSpells",e),!1)})),"Tidy5eSheet"===t.constructor.name){const t=e[0].querySelector(".spellcasting-ability");if(!t)return;t.appendChild(n,t)}else{const t=e[0].querySelector(".spellbook .inventory-list");if(!t)return;n.style.flex="0",n.style.alignSelf="flex-start",n.style.margin="0 8px",t.parentNode.insertBefore(n,t)}}))}s.r(e),s.d(e,"default",(function(){return a}))},"./src/scripts/settings.js":
/*!*********************************!*\
  !*** ./src/scripts/settings.js ***!
  \*********************************/
/*! exports provided: MessSettings */function(t,e,s){"use strict";s.r(e),s.d(e,"MessSettings",(function(){return a}));class a extends FormApplication{static init(){const t="dnd5e"===game.system.id;game.settings.register("mess","actor-item-sort",{name:"Activate item sort button.",hint:"Adds a button to actor sheets for sorting all items of that category alphabetically.",scope:"world",config:!1,default:t,type:Boolean}),game.settings.register("mess","better-draggable",{name:"Activate better drag'n'drop workflow.",scope:"world",config:!1,default:t,type:Boolean}),game.settings.register("mess","better-draggable-lists",{name:"Activate better drag'n'drop workflow for lists.",scope:"world",config:!1,default:!0,type:Boolean}),game.settings.set("mess","better-draggable-lists",!1),game.settings.register("mess","prepared-spell-tracker",{name:"Activate prepared spell tracker",hint:"Adds a tracker to the spellbook tab, providing a way to track the allowed maximum of prepared spells.",scope:"world",config:!1,default:t,type:Boolean}),game.settings.register("mess","add-scrolling",{name:"Activating numerical field scrolling.",hint:"Lets you in-/decrease numerical fields in the Actor sheet using the mouse wheel when focused.",scope:"world",config:!1,default:t,type:Boolean}),game.settings.register("mess","modify-rolling",{name:"Alternative Rolling.",hint:"Changes the way rolling is displayed and executed for DnD5e. Reload for all connected clients is required for this to take effect if changed!",scope:"world",config:!1,default:t,type:Boolean}),game.settings.register("mess","attack-card-always-public",{name:"Roll mode for alternative rolling.",hint:"Always roll attack rolls public, with hidden rolls, but visible target.",scope:"world",config:!1,default:t,type:Boolean}),game.settings.register("mess","modify-templates",{name:"Activate modified templates.",hint:"Makes templates texture fill scaling instead of tiling and does allow the usage of videos as texture. Reload for all connected clients is required for this to take effect if changed!",scope:"world",config:!1,default:!0,type:Boolean}),game.settings.register("mess","change-placeables",{name:"Activate placeables changes.",hint:"Changes some behaviours of placeables, like preview snapping to grid. Reload for all connected clients is required for this to take effect if changed!",scope:"world",config:!1,default:!0,type:Boolean}),game.settings.registerMenu("mess","templateTexture",{name:game.i18n.localize("MESS.FVTTSettings.description"),label:game.i18n.localize("MESS.FVTTSettings.button"),icon:"fas fa-mug-hot",type:a,restricted:!0}),game.settings.register("mess","templateTexture",{name:"Activate placeables changes.",hint:"Changes some behaviours of placeables, like preview snapping to grid. Reload for all connected clients is required for this to take effect if changed!",scope:"world",default:!0,type:Object}),game.settings.register("mess","max-critical",{name:"Activate maximum critical rolls.",hint:"Changes behaviour of critical damage rolls to maximize the damage of the extra dice for criticals!",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("mess","templateTexture",{name:"Activate placeables changes.",hint:"Changes some behaviours of placeables, like preview snapping to grid. Reload for all connected clients is required for this to take effect if changed!",scope:"world",config:!1,default:!0,type:Object}),game.settings.register("mess","templateAutoTargeting",{scope:"world",default:!0,type:Boolean}),game.settings.register("mess","templateDrawBordersOnlyOnHighlight",{scope:"world",default:!0,type:Boolean}),this.loadTemplates()}static loadTemplates(){loadTemplates(["modules/mess/templates/settings/templates.html","modules/mess/templates/settings/dnd5e.html","modules/mess/templates/settings/misc.html"])}static get defaultOptions(){return{...super.defaultOptions,template:"modules/mess/templates/settings/settings.html",height:"auto",title:"Mess - Moerills enhancing super-suit(e) - Settings Menu",width:600,classes:["mess","settings"],tabs:[{navSelector:".tabs",contentSelector:"form",initial:"name"}],submitOnClose:!0}}constructor(t={},e){super(t,e),this.object=game.settings.get("mess","templateTexture")}_getHeaderButtons(){let t=super._getHeaderButtons();return t[0].label="Save & Close",t}getSettingsData(){const t="dnd5e"===game.system.id;let e={"modify-templates":game.settings.get("mess","modify-templates"),"change-placeables":game.settings.get("mess","change-placeables"),templateTexture:game.settings.get("mess","templateTexture"),templateAutoTargeting:game.settings.get("mess","templateAutoTargeting"),templateDrawBordersOnlyOnHighlight:game.settings.get("mess","templateDrawBordersOnlyOnHighlight"),"better-draggable-lists":game.settings.get("mess","better-draggable-lists")};return t&&(e.templateTexture=game.settings.get("mess","templateTexture"),e["modify-rolling"]=game.settings.get("mess","modify-rolling"),e["max-critical"]=game.settings.get("mess","max-critical"),e["actor-item-sort"]=game.settings.get("mess","actor-item-sort"),e["prepared-spell-tracker"]=game.settings.get("mess","prepared-spell-tracker"),e["add-scrolling"]=game.settings.get("mess","add-scrolling"),e["attack-card-always-public"]=game.settings.get("mess","attack-card-always-public")),e}getData(){const t="dnd5e"===game.system.id;let e=super.getData();return t&&(e.dmgTypes=CONFIG.DND5E.damageTypes,e.templateTypes=CONFIG.MeasuredTemplate.types),e.isDnD=t,e.settings=this.getSettingsData(),e}activateListeners(t){super.activateListeners(t)}_updateObject(t,e){const s=expandObject(e);for(let[t,e]of Object.entries(s))game.settings.set("mess",t,e);new Dialog({content:`<p>${game.i18n.localize("MESS.reloadReminder.text")}</p>`,buttons:{yes:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("MESS.reloadReminder.yes"),callback:()=>location.reload()},no:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("MESS.reloadReminder.no")}}}).render(!0)}}}});
//# sourceMappingURL=index.js.map